<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨çƒåœ°ç†è³‡è¨Šç³»çµ± - æ‡¸åœæ„Ÿæ‡‰ç‰ˆ</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; background: #000; font-family: "Microsoft JhengHei", sans-serif; }
        #map { height: 100vh; width: 100%; }

        /* è‡ªå®šç¾©å½ˆå‡ºæ¡†æ¨£å¼ (è·Ÿ Lidicity é¢¨æ ¼ä¸€è‡´) */
        .custom-tooltip {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid #3498db;
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            pointer-events: none; /* ç¢ºä¿æ»‘é¼ ä¸æœƒè¢«æç¤ºæ¡†æ“‹ä½ */
        }
        .tooltip-content { width: 180px; text-align: center; }
        .tooltip-content h3 { margin: 0 0 8px 0; color: #2c3e50; font-size: 18px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .tooltip-content img { width: 100px; border: 1px solid #ddd; margin-bottom: 8px; border-radius: 3px; }
        .tooltip-content p { margin: 3px 0; font-size: 13px; color: #555; text-align: left; }
    </style>
</head>
<body>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // 1. åˆå§‹åŒ–åœ°åœ–
        const map = L.map('map', {
            center: [20, 0],
            zoom: 3,
            maxBounds: [[-90, -180], [90, 180]],
            worldCopyJump: true
        });

        // 2. è¡›æ˜Ÿåº•åœ–
        L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}').addTo(map);

        // 3. é è¼‰åœ‹åç¿»è­¯ (é˜²æ­¢æŠ“ä¸åˆ°ä¸­æ–‡)
        const nameMap = { "Taiwan": "è‡ºç£", "Japan": "æ—¥æœ¬", "China": "ä¸­åœ‹", "USA": "ç¾åœ‹", "Russia": "ä¿„ç¾…æ–¯", "France": "æ³•åœ‹" };

        // 4. è¼‰å…¥å…¨çƒé‚Šç•Œä¸¦è¨­å®šã€Œç¢°åˆ°å³é¡¯ç¤ºã€
        fetch('https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson')
            .then(res => res.json())
            .then(data => {
                L.geoJSON(data, {
                    style: {
                        color: "white",
                        weight: 1,
                        fillColor: "#3498db",
                        fillOpacity: 0.1
                    },
                    onEachFeature: function (feature, layer) {
                        const engName = feature.properties.ADMIN || feature.properties.name;
                        
                        // æ»‘é¼ ç§»å…¥ï¼šæŠ“å–è³‡æ–™ä¸¦å½ˆå‡º
                        layer.on('mouseover', async function (e) {
                            // é«˜äº®åœ‹å®¶
                            this.setStyle({ fillOpacity: 0.4, weight: 2, color: "#f1c40f" });

                            try {
                                // å¿«é€ŸæŠ“å–åŸºæœ¬è³‡æ–™ (åœ‹æ——ã€é¦–éƒ½)
                                const res = await fetch(`https://restcountries.com/v3.1/name/${encodeURIComponent(engName)}?fullText=true`);
                                const cData = await res.json();
                                const c = cData[0];
                                const zhName = c.translations.zho ? c.translations.zho.common : engName;

                                // å»ºç«‹ç°¡çŸ­ä»‹ç´¹å…§å®¹
                                const content = `
                                    <div class="tooltip-content">
                                        <h3>${zhName}</h3>
                                        <img src="${c.flags.png}">
                                        <p><b>ğŸ“ é¦–éƒ½ï¼š</b>${c.capital ? c.capital[0] : 'ç„¡'}</p>
                                        <p><b>ğŸ‘¥ äººå£ï¼š</b>${c.population.toLocaleString()}</p>
                                        <p style="color:#3498db; font-size:11px;">(é»æ“Šå¯çœ‹ç™¾ç§‘ä»‹ç´¹)</p>
                                    </div>
                                `;

                                // ç¶å®šä¸¦é–‹å•Ÿå·¥å…·æç¤º
                                layer.bindTooltip(content, {
                                    sticky: true, // è®“æç¤ºæ¡†è·Ÿè‘—æ»‘é¼ è·‘
                                    className: 'custom-tooltip',
                                    opacity: 1,
                                    direction: 'top'
                                }).openTooltip();

                            } catch (err) {
                                layer.bindTooltip(engName).openTooltip();
                            }
                        });

                        // æ»‘é¼ ç§»å‡ºï¼šé‚„åŸæ¨£å¼
                        layer.on('mouseout', function () {
                            this.setStyle({ fillOpacity: 0.1, weight: 1, color: "white" });
                        });

                        // é»æ“Šäº‹ä»¶ï¼šä¿ç•™è·³è½‰åŠŸèƒ½
                        layer.on('click', function () {
                            window.open(`https://zh.wikipedia.org/wiki/${encodeURIComponent(engName)}`, '_blank');
                        });
                    }
                }).addTo(map);
            });
    </script>
</body>
</html>
